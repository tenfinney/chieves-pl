(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[971],{27327:function(e,r,n){"use strict";n.r(r),n.d(r,{New:function(){return S}});var t=n(95235),c=n(8529),s=n(20406),a=n(28526),o=n.n(a),i=n(39323),u=n(64033),l=n(41215),d=n(3850),h=n(69204),x=n(26106),f=n(80038),p=n(86915),j=n(79338),m=n(64618),v=n(2784),b=n(2241),w=n(10508),k=n(97729),g=n(5632),y=n(63955),C=n(52322);function O(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function E(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?O(Object(n),!0).forEach((function(r){(0,t.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var S=function(){return(0,C.jsxs)(u.W2,{maxW:"full",children:[(0,C.jsx)(k.default,{children:(0,C.jsx)("title",{children:"New SmartLaw Cred Token"})}),(0,C.jsx)(l.m$.header,{children:(0,C.jsx)(u.kC,{justify:"center",children:(0,C.jsx)(i.h4,{my:"1vh",maxW:"xl"})})}),(0,C.jsx)(l.m$.main,{children:(0,C.jsx)(I,{})})]})},I=function(){var e=(0,m.$6)(),r=e.ensProvider,n=e.roContract,t=e.rwContract,a=e.connecting,k=e.connect,O=e.chain,S=e.address,I=(0,g.useRouter)().query.tokenId,P=(0,v.useState)(Array.isArray(I)?I[0]:I),T=P[0],_=P[1],N=(0,v.useState)([]),Z=N[0],A=N[1],$=(0,v.useState)(!1),D=$[0],R=$[1],W=(0,y.cI)(),X=W.register,q=W.handleSubmit,z=(0,d.pm)();(0,v.useEffect)((function(){"string"===typeof I&&_(I)}),[I]),(0,v.useEffect)((function(){var e=function(){var e=(0,s.Z)(o().mark((function e(){var r,t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=10;break}return console.log({roContract:n}),e.next=4,n.roleIndexForName("ReservedLast");case 4:return e.t0=e.sent,r=e.t0-1,e.next=8,Promise.all(Array.from({length:r}).map(function(){var e=(0,s.Z)(o().mark((function e(r,t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.roleNameByIndex(t+1);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r,n){return e.apply(this,arguments)}}()));case 8:t=e.sent,A(t);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[n]);var L=(0,v.useCallback)(function(){var e=(0,s.Z)(o().mark((function e(a){var i,u,l,d,h,x,f,p,j,m,v,b,w,k;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(R(!0),e.prev=1,t){e.next=4;break}throw new Error("Connect your Web3 account to reserve an ID.");case 4:if(n){e.next=6;break}throw new Error("Library not loaded.");case 6:if(r){e.next=8;break}throw new Error("ENS provider not defined.");case 8:return i=[],u=[],e.next=12,Promise.all(Object.entries(a).map(function(){var e=(0,s.Z)(o().mark((function e(r){var n,s,a,l,d,h,x,f,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(0,c.Z)(r,2),s=n[0],"boolean"!==typeof(a=n[1])||!a){e.next=15;break}return d=null!==(l=s.match(/^(grant|disable)\((.+)\)$/))&&void 0!==l?l:[],h=(0,c.Z)(d,3),h[0],x=h[1],f=h[2],console.log({type:x,role:f}),e.next=6,t.roleIndexForName(f);case 6:p=e.sent,e.t0=x,e.next="grant"===e.t0?10:"disable"===e.t0?12:14;break;case 10:return i.push(p),e.abrupt("break",15);case 12:return u.push(p),e.abrupt("break",15);case 14:throw new Error("Unknown operation: ".concat(x));case 15:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()));case 12:if(""===(l=a.maintainer)&&(l=S),!l.includes(".")){e.next=18;break}return e.next=17,r.resolveName(l);case 17:l=e.sent;case 18:return e.next=20,t["create(address,uint8[],uint8[])"](l,i,u);case 20:return d=e.sent,e.next=23,d.wait();case 23:if(h=e.sent,x=h.events.find((function(e){return"Created"===e.event}))){e.next=27;break}throw new Error("Couldn\u2019t find a token creation event.");case 27:f=(0,c.Z)(x.args,2),p=f[0],f[1],_(p.toHexString()),e.next=36;break;case 31:e.prev=31,e.t0=e.catch(1),console.error({error:e.t0}),k=null!==(j=null!==(m=null!==(v=null===(b=e.t0.error)||void 0===b?void 0:b.message)&&void 0!==v?v:null===(w=e.t0.data)||void 0===w?void 0:w.message)&&void 0!==m?m:e.t0.message)&&void 0!==j?j:e.t0,z({title:"Creation Error",description:k,status:"error",isClosable:!0,duration:1e4});case 36:return e.prev=36,R(!1),e.finish(36);case 39:case"end":return e.stop()}}),e,null,[[1,31,36,39]])})));return function(r){return e.apply(this,arguments)}}(),[t]);return t&&T&&!D?(0,C.jsx)(i.g_,{tokenId:T}):(0,C.jsx)(u.M5,{children:(0,C.jsxs)(u.Kq,{children:[(0,C.jsxs)(u.X6,{textAlign:"center",children:["Create a new",(0,C.jsx)(l.m$.span,{title:"Unique Cred Token",ml:2,children:"Cred Token"})]}),a?(0,C.jsxs)(u.kC,{justify:"center",children:[(0,C.jsx)(h.$,{thickness:"4px"}),(0,C.jsx)(u.xv,{ml:2,children:"Connecting\u2026"})]}):O&&O!==b.g.contract.chainId?(0,C.jsxs)(x.zx,{colorScheme:"blue",onClick:function(){(0,w.gu)(b.g.contract.chainId)},children:["Switch to the",(0,C.jsx)(l.m$.span,{mx:1.5,title:"".concat(O," \u2260 ").concat(b.g.contract.chainId),children:b.g.contract.name}),"chain"]}):t?D?(0,C.jsxs)(u.kC,{justify:"center",mt:7,children:[(0,C.jsx)(h.$,{}),(0,C.jsx)(u.xv,{ml:2,children:"Reserving your token\u2026"})]}):T?(0,C.jsx)(u.xv,{children:"We are glad you showed up!"}):(0,C.jsxs)(u.Kq,{as:"form",onSubmit:q(L),children:[(0,C.jsx)(f.II,E(E({},X("maintainer")),{},{placeholder:"Maintainer Address (default Creator)"})),(0,C.jsxs)(p.iA,{mb:5,children:[(0,C.jsx)(p.hr,{children:(0,C.jsxs)(p.Tr,{children:[(0,C.jsx)(p.Th,{children:"Role"}),(0,C.jsx)(p.Th,{children:"Grant"}),(0,C.jsx)(p.Th,{children:"Disable"})]})}),(0,C.jsx)(p.p3,{children:Z.map((function(e,r){return(0,C.jsxs)(p.Tr,{children:[(0,C.jsx)(p.Td,{children:e}),(0,C.jsx)(p.Td,{textAlign:"center",children:(0,C.jsx)(j.XZ,E({},X("grant(".concat(e,")"))))}),(0,C.jsx)(p.Td,{textAlign:"center",children:(0,C.jsx)(j.XZ,E({},X("disable(".concat(e,")"))))})]},r)}))})]}),(0,C.jsx)(x.zx,{colorScheme:"green",type:"submit",children:"Reserve an ID"})]}):(0,C.jsx)(x.zx,{colorScheme:"blue",onClick:k,children:"Connect"})]})})};r.default=S},18310:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/new",function(){return n(27327)}])}},function(e){e.O(0,[730,338,323,774,888,179],(function(){return r=18310,e(e.s=r);var r}));var r=e.O();_N_E=r}]);